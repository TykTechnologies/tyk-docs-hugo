{{- $pagePath := replace .Page.RelPermalink "/docs" "" -}}
{{- $pagePath := replace $pagePath "/nightly" "" -}}
{{- $pagePath := replace $pagePath "/" "" -}}
{{- $showEmptyPages := .Site.Params.showEmptyPages -}}

<div class="tabs-wrapper">
  <div class="tabs-container">
    {{- range .Site.Data.menu.menu -}}
      {{- if eq .category "Tab" -}}
        {{- $selected := false -}}
        {{- $is_home := eq (lower .title) "home" -}}
        {{- $path_not_empty := false -}}
        {{- $path := replace .path "/" "" -}}
        {{- $has_active_child := false -}}

        {{- if eq $path $pagePath -}}
          {{- if or (ne $pagePath "") $is_home -}}
            {{- $selected = true -}}
            {{- $path_not_empty = true -}}
          {{- end -}}
        {{- end -}}

        {{- if (isset . "menu") -}}
          {{- range .menu -}}
            {{- $childPath := replace .path "/" "" -}}
            {{- if eq $childPath $pagePath -}}
              {{- if or (ne $pagePath "") $is_home -}}
                {{- $selected = true -}}
                {{- $has_active_child = true -}}
                {{- $path_not_empty = true -}}
              {{- end -}}
            {{- end -}}
            {{- if (isset . "menu") -}}
              {{- range .menu -}}
                {{- $grandChildPath := replace .path "/" "" -}}
                {{- if eq $grandChildPath $pagePath -}}
                  {{- if or (ne $pagePath "") $is_home -}}
                    {{- $selected = true -}}
                    {{- $has_active_child = true -}}
                    {{- $path_not_empty = true -}}
                  {{- end -}}
                {{- end -}}
                {{- if (isset . "menu") -}}
                  {{- range .menu -}}
                    {{- $greatGrandChildPath := replace .path "/" "" -}}
                    {{- if eq $greatGrandChildPath $pagePath -}}
                      {{- if or (ne $pagePath "") $is_home -}}
                        {{- $selected = true -}}
                        {{- $has_active_child = true -}}
                        {{- $path_not_empty = true -}}
                      {{- end -}}
                    {{- end -}}
                  {{- end -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
        {{- end -}}

        {{- if or (.show) ($showEmptyPages) -}}
          <div class="tab-item {{if (or $selected $has_active_child)}}nav_sub_active{{end}}">
            {{- if .url -}}
              <a href="{{ .url }}" class="tab-link {{if not .show}} paint-red {{end}} {{if (or $selected $has_active_child)}} active{{end}}">{{- .title -}}</a>
            {{- else -}}
              {{- $prefixPath := strings.TrimLeft "/" .path -}}
              <a href="{{$prefixPath | relURL}}" class="tab-link {{if not .show}} paint-red {{end}} {{if (or $selected $has_active_child)}} active{{end}}">{{- .title -}}</a>
            {{- end -}}
          </div>
        {{- end -}}
      {{- end -}}
    {{- end -}}
  </div>
</div>
