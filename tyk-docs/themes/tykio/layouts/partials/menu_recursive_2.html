


{{- $page := .page -}}
{{- $pattern := `\/docs\/\d+\.\d+` -}}
{{- $pagePath := replaceRE $pattern "" .page.RelPermalink -}}
{{- $pagePath := replace $pagePath "/docs" "" -}}
{{- $pagePath := replace $pagePath "/nightly" "" -}}
{{- $pagePath := replace $pagePath "/" "" -}}

<ul>
    {{- range .menu -}}
      <!-- Check if the "show" field exists and is true, or is undefined (default to true) -->
      {{- $showPage := true -}}
      {{- if isset . "show" -}}
        {{- $showPage = .show -}}
      {{- end -}}

      {{- if $showPage -}} <!-- Only show the menu item if "show" is true or undefined -->
        {{- $is := false -}}
        {{- $has := false -}}

        {{- $path := replace .path "/" "" -}}
        {{- if eq $path $pagePath -}}
          {{- $has = true -}}
          {{- $is = true -}}
        {{- end -}}

        {{- if (isset . "menu") -}}

          <li class="category-{{.category}} {{if $is}} active {{end}} {{if or $is $has (eq .category `Label`)}} st-open {{else}} st-collapsed {{end}}">
            {{- if .path -}}
              {{- $prefixPath := strings.TrimLeft "/" .path -}}
              <a href="{{$prefixPath | relURL}}" class="{{if not .show}} paint-red {{end}}">
                {{- .title -}}
              </a>
            {{- else -}}
              <a class="{{if not .show}} paint-red {{end}}">{{- .title -}}</a>
            {{- end -}}

            {{ partial "menu_recursive_2.html" (dict "menu" .menu "page" $page) }}

          </li>

        {{- else -}}
          <li class="st-file {{if $is}} active {{end}} {{if not .show}} paint-red {{end}}">
            {{- $prefixPath := strings.TrimLeft "/" .path -}}
            {{- $prefixPath := strings.TrimRight "/" .path -}}
            {{- $prefixMD := printf "%s.md" $prefixPath -}}

            {{- if $prefixPath -}}
              <a href="/docs/nightly/{{.path}}" class="{{if not .show}} paint-red {{end}}">
                {{- .title -}}
              </a>
            {{- else -}}
              {{- .title -}}
            {{- end -}}

            {{- if not .path}}
              {{- warnf "Found page without path %q" .title -}}
            {{- end -}}

          </li>
        {{- end -}}
      {{- end -}} <!-- End of showPage check -->
    {{- end -}}
</ul>