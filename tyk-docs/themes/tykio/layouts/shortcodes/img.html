{{ $s := . }}
{{ $src := $s.Get "src" }}
{{ $image := resources.Get $src }}
{{ if hasPrefix $src "http"}}
{{ else }}
  {{ with $image }}
    {{ $src = .RelPermalink }}
    {{ if gt .Width 1000 }}
      {{ $src = .Fit("1000x").RelPermalink }}
    {{ end }}
  {{ else }}
    {{ errorf "Wrong image url '%s' in %v" $src $s.Page.File.Path $s.Position }}
  {{ end }}
{{ end }}

<p><img src="{{ $src }}" alt="{{ .Get "alt"}}" width="{{ .Get "width"}}" height="{{ .Get "height"}}" /></p>
